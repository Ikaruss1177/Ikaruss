<!DOCTYPE html>
<html>
<head>
    <style>
        body { margin:0; background:#000; color:#FFD700; font-family:arial; }
        h1 { text-align:center; padding:10px; }
        #selector { text-align:center; padding:10px; }
        select { background:#111; color:#FFD700; padding:5px; font-size:16px; margin:5px; }
        button { background:#FFD700; color:#000; padding:8px 20px; font-size:16px; cursor:pointer; border:none; }
        #emulador { display:flex; justify-content:center; margin-top:10px; }
        #btnVolver { display:none; margin:10px auto; }  /* Botón para volver */
    </style>
</head>
<body>
    <h1>Emuladores Macross</h1>
    <div id="menu">
        <div id="selector">
            <select id="consola">
                <option value="">Selecciona consola</option>
                <option value="nes">NES</option>
                <option value="snes">SNES</option>
                <option value="mame">MAME</option>
            </select>
            <select id="juego">
                <option value="">Selecciona juego</option>
            </select>
            <button id="btnJugar" type="button">Jugar</button>
        </div>
    </div>
    <div id="emulador"></div>
    <button id="btnVolver">Volver al Menú</button>  <!-- Botón nuevo -->
    <script>
        const base = 'https://ikaruss1177.github.io/Ikaruss/';
        const juegos = {
            nes: [
                { nombre: 'SDF Macross', archivo: base + 'Chou%20Jikuu%20Yousai%20-%20Macross%20(J).nes', core: 'nes' }
            ],
            snes: [
                { nombre: 'Macross Scrambled Valkyrie', archivo: base + 'Choujikuu%20Yousai%20Macross%20-%20Scrambled%20Valkyrie%20(J).smc', core: 'snes' }
            ],
            mame: [
                { nombre: 'Super Space Fortress Macross', archivo: base + 'macross.zip', core: 'arcade', bios: base + 'nmk004.zip' },
                { nombre: 'Macross II', archivo: base + 'macross2.zip', core: 'arcade', bios: base + 'mac2bios.zip' },
                { nombre: 'Macross Plus', archivo: base + 'macrossp.zip', core: 'arcade', bios: base + 'macsbios.zip' }
            ]
        };
        const params = new URLSearchParams(window.location.search);
        if (params.get('core') && params.get('rom')) {
            // No esconder menú completamente, solo mostrar emulador y botón volver
            document.getElementById('emulador').innerHTML = '<div style="width:640px;height:480px;position:relative;"><div id="game" style="width:100%;height:100%;"></div></div>';
            document.getElementById('btnVolver').style.display = 'block';  // Muestra botón

            // Variables para EmulatorJS con CDN
            window.EJS_player = '#game';
            window.EJS_core = params.get('core');
            window.EJS_gameUrl = params.get('rom');
            window.EJS_pathtodata = 'https://cdn.emulatorjs.org/stable/data/';  // CDN oficial

            // BIOS para arcade
            if (params.get('core') === 'arcade') {
                window.EJS_biosUrl = params.get('bios');  // Pasado como param
            }

            // Carga loader desde CDN
            var script = document.createElement('script');
            script.src = 'https://cdn.emulatorjs.org/stable/data/loader.js';
            document.body.appendChild(script);
        }
        function actualizarJuegos() {
            const consola = document.getElementById('consola').value;
            const selectJuego = document.getElementById('juego');
            selectJuego.innerHTML = '<option value="">Selecciona juego</option>';
            if (consola && juegos[consola]) {
                juegos[consola].forEach((j, i) => {
                    selectJuego.innerHTML += '<option value="' + i + '">' + j.nombre + '</option>';
                });
            }
        }
        function cargarJuego() {
            const consola = document.getElementById('consola').value;
            const idx = document.getElementById('juego').value;
            if (!consola || idx === '') return;
            const juego = juegos[consola][idx];
            let url = '?core=' + juego.core + '&rom=' + encodeURIComponent(juego.archivo);
            if (juego.bios) url += '&bios=' + encodeURIComponent(juego.bios);  // Pasa bios como param
            window.location.href = url;
        }
        // Evento para volver al menú (sin recargar, solo limpia emulador)
        document.getElementById('btnVolver').addEventListener('click', () => {
            document.getElementById('emulador').innerHTML = '';  // Limpia emulador
            document.getElementById('btnVolver').style.display = 'none';  // Esconde botón
            // Opcional: Reset selects si querés
            document.getElementById('consola').value = '';
            document.getElementById('juego').innerHTML = '<option value="">Selecciona juego</option>';
        });
        document.getElementById('consola').addEventListener('change', actualizarJuegos);
        document.getElementById('btnJugar').addEventListener('click', cargarJuego);
    </script>
    <!-- Discord Embedded App SDK (agregá tu CLIENT_ID) -->
    <script src="https://cdn.jsdelivr.net/npm/@discord/embedded-app-sdk@latest/dist/index.umd.js"></script>
    <script>
        const CLIENT_ID = 'TU_CLIENT_ID_AQUI';  // Reemplazá con el real
        const discordSdk = new DiscordSDK(CLIENT_ID);
        
        discordSdk.ready().then(() => {
            console.log('¡Emulador listo en Discord!');
            // Opcional: Setear Rich Presence
            // discordSdk.commands.SetActivity({ ... });
        }).catch(err => console.error('SDK error:', err));
        
        // Detectar si está en Discord y ajustar (opcional, para fullscreen)
        if (window.self !== window.top) {
            document.body.style.margin = '0';
            document.body.style.overflow = 'hidden';
        }
    </script>
</body>
</html>
